<h2 class="text-success mb-4">Sign up</h2>
<div *ngIf="!isCodeFromUrl">
  Already have an account?
  <a
    routerLink="/user/signin"
    class="text-decoration-none fw-medium text-success"
    >Sign in</a
  >
</div>

<mat-horizontal-stepper linear #stepper>
  <!-- Step 1 -->
  <mat-step [stepControl]="form.get('fullName')!">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <ng-template matStepLabel>Personal Informations</ng-template>

      <div class="mb-3">
        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Full Name</mat-label>
          <input matInput placeholder="Full Name" formControlName="fullName" />
        </mat-form-field>
        <div class="error-feedback" *ngIf="hasDisplayableError('fullName')">
          <ng-container
            [ngSwitch]="form.controls['fullName'].errors | firstKey"
          >
            <div *ngSwitchCase="'required'">Please enter your full name.</div>
            <div *ngSwitchCase="'minlength'">
              At least 6 characters required.
            </div>
          </ng-container>
        </div>
      </div>

      <div class="mb-3">
        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Email</mat-label>
          <input matInput placeholder="Email" formControlName="email" />
        </mat-form-field>
        <div class="error-feedback" *ngIf="hasDisplayableError('email')">
          <div *ngIf="form.controls['email'].hasError('required')">
            Please enter your email address.
          </div>
          <div *ngIf="form.controls['email'].hasError('email')">
            Please enter a valid email address.
          </div>
        </div>
      </div>
      <div class="mb-3" *ngIf="!isCodeFromUrl">
        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Invitation Code</mat-label>
          <input matInput formControlName="invitationCode" />
        </mat-form-field>
        <div
          class="error-feedback"
          *ngIf="hasDisplayableError('invitationCode')"
        >
          <div *ngIf="form.controls['invitationCode'].hasError('required')">
            Please enter your invitation code.
          </div>
        </div>
      </div>

      <div *ngIf="isUser" class="mb-3">
        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Group Name</mat-label>
          <input matInput formControlName="groupName" readonly />
        </mat-form-field>
        <div class="form-text">
          You are registering for this specific group.
        </div>
      </div>
      <div class="mb-3">
        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Password</mat-label>
          <input matInput type="password" formControlName="password" />
        </mat-form-field>
        <div class="error-feedback" *ngIf="hasDisplayableError('password')">
          <ng-container
            [ngSwitch]="form.controls['password'].errors | firstKey"
          >
            <div *ngSwitchCase="'required'">Please enter your password.</div>
            <div *ngSwitchCase="'minlength'">
              At least 6 characters required.
            </div>
            <div *ngSwitchCase="'pattern'">
              One or more special characters required.
            </div>
          </ng-container>
        </div>
      </div>

      <div class="mb-3">
        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Confirm Password</mat-label>
          <input matInput type="password" formControlName="confirmPassword" />
        </mat-form-field>
        <div
          class="error-feedback"
          *ngIf="
            hasDisplayableError('confirmPassword') &&
            form.controls['confirmPassword'].hasError('passwordMismatch')
          "
        >
          Passwords don't match.
        </div>
      </div>

      <div class="mt-3">
        <button *ngIf="isAdmin"
          mat-button
          matStepperNext
          type="button"
          [disabled]="
            form.get('fullName')?.invalid || form.get('email')?.invalid || form.controls['confirmPassword'].hasError('passwordMismatch')
          "
        >
          Next
        </button>
        <button *ngIf="isUser || !isCodeFromUrl"
        mat-flat-button
        color="primary"
        type="submit"
        [disabled]="form.invalid"
      >
        Register
      </button>
      </div>
    </form>
  </mat-step>

<div *ngIf="isAdmin">
  <mat-step>
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <ng-template matStepLabel>Create group</ng-template>
      <div class="mb-3">
        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Create Group</mat-label>
          <input matInput placeholder="Group Name" formControlName="createGroupName" />
        </mat-form-field>
        <div class="error-feedback" *ngIf="hasDisplayableError('createGroupName')">
          <ng-container
            [ngSwitch]="form.controls['createGroupName'].errors | firstKey"
          >
            <div *ngSwitchCase="'required'">Please enter a group name.</div>
            <div *ngSwitchCase="'minlength'">
              At least 3 characters required.
            </div>
          </ng-container>
        </div>
      </div>
      <div class="mt-3">
        <button mat-button matStepperPrevious>Back</button>
        <button
          mat-flat-button
          color="primary"
          type="submit"
          [disabled]="form.invalid"
        >
          Register
        </button>
      </div>
    </form>
  </mat-step>
</div>
</mat-horizontal-stepper>
